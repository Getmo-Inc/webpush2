!function(){"use strict";function t(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function e(t){return"string"!=typeof t&&(t=String(t)),t}function i(t){this.map={},t instanceof i?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function r(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function s(t){return new Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function n(t){var e=new FileReader;return e.readAsArrayBuffer(t),s(e)}function a(t){var e=new FileReader;return e.readAsText(t),s(e)}function o(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(p.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(p.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(t){if(!p.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText=""},p.blob?(this.blob=function(){var t=r(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(n)},this.text=function(){var t=r(this);if(t)return t;if(this._bodyBlob)return a(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=r(this);return t?t:Promise.resolve(this._bodyText)},p.formData&&(this.formData=function(){return this.text().then(u)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(t){var e=t.toUpperCase();return l.indexOf(e)>-1?e:t}function h(t,e){e=e||{};var r=e.body;if(h.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new i(t.headers)),this.method=t.method,this.mode=t.mode,r||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",(e.headers||!this.headers)&&(this.headers=new i(e.headers)),this.method=d(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function u(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),r=i.shift().replace(/\+/g," "),s=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(s))}}),e}function c(t){var e=new i,r=t.getAllResponseHeaders().trim().split("\n");return r.forEach(function(t){var i=t.trim().split(":"),r=i.shift().trim(),s=i.join(":").trim();e.append(r,s)}),e}function f(t,e){e||(e={}),this._initBody(t),this.type="default",this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof i?e.headers:new i(e.headers),this.url=e.url||""}if(!self.fetch){i.prototype.append=function(i,r){i=t(i),r=e(r);var s=this.map[i];s||(s=[],this.map[i]=s),s.push(r)},i.prototype["delete"]=function(e){delete this.map[t(e)]},i.prototype.get=function(e){var i=this.map[t(e)];return i?i[0]:null},i.prototype.getAll=function(e){return this.map[t(e)]||[]},i.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},i.prototype.set=function(i,r){this.map[t(i)]=[e(r)]},i.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(i){this.map[i].forEach(function(r){t.call(e,r,i,this)},this)},this)};var p={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self},l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];h.prototype.clone=function(){return new h(this)},o.call(h.prototype),o.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new i(this.headers),url:this.url})},f.error=function(){var t=new f(null,{status:0,statusText:""});return t.type="error",t};var m=[301,302,303,307,308];f.redirect=function(t,e){if(-1===m.indexOf(e))throw new RangeError("Invalid status code");return new f(null,{status:e,headers:{location:t}})},self.Headers=i,self.Request=h,self.Response=f,self.fetch=function(t,e){return new Promise(function(i,r){function s(){return"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0}var n;n=h.prototype.isPrototypeOf(t)&&!e?t:new h(t,e);var a=new XMLHttpRequest;a.onload=function(){var t=1223===a.status?204:a.status;if(100>t||t>599)return void r(new TypeError("Network request failed"));var e={status:t,statusText:a.statusText,headers:c(a),url:s()},n="response"in a?a.response:a.responseText;i(new f(n,e))},a.onerror=function(){r(new TypeError("Network request failed"))},a.open(n.method,n.url,!0),"include"===n.credentials&&(a.withCredentials=!0),"responseType"in a&&p.blob&&(a.responseType="blob"),n.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send("undefined"==typeof n._bodyInit?null:n._bodyInit)})},self.fetch.polyfill=!0}}(),function(t){var e=-1===(t.location.href+"").indexOf("local.getmo.")?"https://api.getmo.com.br":"https://local.getmo.api",i={iframe:document.createElement("iframe"),event:document.createElement("div"),events:{listeners:[],on:function(t,e){this.listeners.push({name:t,callback:e}),i.event.addEventListener(t,e)},off:function(t){for(var e=0;e<this.listeners.length;e++)this.listeners[e].name==t&&(i.event.removeEventListener(t,this.listeners[e].callback),this.listeners.splice(e,1))},trigger:function(t){i.event.dispatchEvent(new CustomEvent(t))},once:function(t){i.event.dispatchEvent(new CustomEvent(t)),this.off(t)}},control:{hasSetup:!1,eventForPostMassageIsListening:!1,register:{tries:0,waitInSeconds:10,maxTimeoutInMinutes:1}},registerEndPoint:e+"/device",optOutEndPoint:e+"/device/optout",tagEndPoint:e+"/tag",notificationEndPoint:e+"/notifications",safariEndPoint:e+"/safari",params:{devid:null,appid:null,hwid:null,regid:null,platform:null,setupEndPoint:null,safariPushID:null},_checkSupport:function(t){if(!("postMessage"in window))return void console.warn('"postMessage" is not supported.');if(!("Notification"in window))return void console.warn('"Notification" is not supported.');if(!this._checkLocalStorageSupport())return void console.error('"localStorage" is NOT supported.');if("CHROME"==t||"FIREFOX"==t){if("denied"===Notification.permission)return void console.warn("The user has blocked notifications. Check the current Notification permission. If its denied, it's a permanent block until the user changes the permission");try{if(!("showNotification"in ServiceWorkerRegistration.prototype))return void console.warn('"showNotification" is not supported.')}catch(e){return void console.warn('"showNotification" is not supported.',e)}if(!("serviceWorker"in navigator))return void console.warn('"serviceWorker" is not supported.');if(!("PushManager"in window))return void console.warn('"PushManager" is not supported.')}else if("SAFARI"==t&&!("pushNotification"in window.safari))return void console.warn('"pushNotification" is not supported.');return!0},_checkLocalStorageSupport:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},_getPlatform:function(){if("chrome"in window&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))return"CHROME";if(/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)){if("safari"in window)return"SAFARI";console.warn('Probably the user is using a mobile safari browser! "safari" object is not present on "window"')}return/Firefox/.test(navigator.userAgent)&&"undefined"!=typeof InstallTrigger?"FIREFOX":!1},_setParams:function(e){if("object"==typeof e){var i="smartpush_params";try{var r=JSON.parse(t.localStorage.getItem(i));for(var s in r)r.hasOwnProperty(s)&&(this.params[s]=r[s])}catch(n){}for(var s in e)e.hasOwnProperty(s)&&(this.params[s]=e[s]);t.localStorage.setItem(i,JSON.stringify(this.params))}},_getParam:function(t){if(this.params[t])return this.params[t];var e="smartpush_params";try{var i=JSON.parse(localStorage.getItem(e));return i[t]?(this.params[t]=i[t],i[t]):null}catch(r){return null}},_encodeParams:function(t){if("object"==typeof t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")}return"string"==typeof t?t:(console.error('Parameters cannot be parsed. Use "object" or a url encoded "string". Unknown type...',typeof t),!1)},_ajax:function(t,e,i,r){i?(e._method=i,i="POST"):i="POST";var s=this._encodeParams(e);return t&&s?fetch(t,{method:i,headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:s}):!1},_request:function(t,e,i){return new Promise(function(r,s){this._ajax(t,e,i).then(function(t){t.json().then(function(t){r(t)},function(t){s(t)})},function(t){s(t)})}.bind(this))},_processMessageFromIframe:function(e){switch(e.data.status){case"ready":case"status-false-checked":case"status-denied-checked":case"subscribed-error":case"setup-error":case"safari-has-setup":this.events.once(e.data.status);break;case"status-true-checked":this._setParams({hwid:e.data.hwid,regid:e.data.regid}),this.events.once(e.data.status);break;case"status-sm-unreachable":case"setup-ssl-error":if(!this._getParam("setupEndPoint")){this.events.once(e.data.status);break}case"registered-redirect":var i=this._encodeParams({subscribe:!0,callback:t.location.href});t.location.href=this.iframe.src+"?"+i;break;case"subscribed":this._setParams({hwid:e.data.hwid,regid:e.data.regid}),this.events.once(e.data.status);break;case"unsubscribed":break;case"default":console.warn("The user close the ask box without answer to receive Notifications."),this.events.once("registered-error");break;case"denied":console.warn("Permission for Notifications was denied. The user denied the notification permission which means we failed to subscribe and the user will need to manually change the notification permission to subscribe to push messages."),this.events.once("registered-error");break;case"local-storage-center-params":this._setParams(e.data.params),this.events.once("iframe-local-storage-params");break;default:console.error("default: e.data.status = "+e.data.status)}},_addIframe:function(){var t=!1;this.iframe.id="smartpush-webpush-iframe",this.iframe.style.display="none",this.iframe.src=(this._getParam("setupEndPoint")?this._getParam("setupEndPoint"):"")+"/webpush.html",this.iframe.onload=function(e){t||(t=!0,this.iframe.contentWindow.postMessage({method:"initialize",params:{devid:this._getParam("devid"),appid:this._getParam("appid"),platform:this._getParam("platform"),setupEndPoint:this._getParam("setupEndPoint")}},"*"))}.bind(this),document.body.appendChild(this.iframe)},_addIframeEvents:function(){this.control.eventForPostMassageIsListening===!1&&(t.addEventListener?t.addEventListener("message",function(t){t.data.status&&"smartpush.webpush.iframe"==t.data.source&&this._processMessageFromIframe(t)}.bind(this),!1):t.attachEvent("onmessage",function(t){t.data.status&&"smartpush.webpush.iframe"==t.data.source&&this._processMessageFromIframe(t)}.bind(this)),this.control.eventForPostMassageIsListening=!0)},_setup:function(){return new Promise(function(t,e){if("CHROME"==this._getParam("platform")||"FIREFOX"==this._getParam("platform")){if(this.control.hasSetup===!0)return t();this.events.on("ready",function(){this.control.hasSetup=!0,t()}.bind(this)),this.events.on("setup-error",function(){e("error")}),this.events.on("setup-ssl-error",function(){console.error("DOMException: Only secure origins are allowed (see: https://goo.gl/Y0ZkNV)."),e("ssl-error")}),this._addIframeEvents(),this._addIframe()}else if("SAFARI"==this._getParam("platform")){if(this._getParam("safariPushID"))return t(),!0;var i=this.safariEndPoint+"/getPushID";this._request(i,{devid:this._getParam("devid"),appid:this._getParam("appid")},"POST").then(function(i){(i.code=i.safariPushID)?(this._setParams({safariPushID:i.safariPushID}),this._getParam("setupEndPoint")?(this.events.on("safari-has-setup",function(){t()}),this._addIframeEvents(),this._addIframe()):t()):e(i.message)}.bind(this),function(t){console.error("Cannot fetch safari app Push ID",t),e(t)})}}.bind(this))},checkStatus:function(){return new Promise(function(e,i){this._setup().then(function(){if("CHROME"==this._getParam("platform")||"FIREFOX"==this._getParam("platform"))this.events.on("status-true-checked",function(){e(this)}.bind(this)),this.events.on("status-false-checked",function(){i("default")}),this.events.on("status-denied-checked",function(){i("denied")}),this.events.on("status-sm-unreachable",function(){this._getParam("setupEndPoint")||(document.body.removeChild(document.getElementById("smartpush-webpush-iframe")),this.control.hasSetup=!1),i("default")}.bind(this)),this.iframe.contentWindow.postMessage({method:"checkSubscriptionStatus"},"*");else if("SAFARI"==this._getParam("platform")){var r=t.safari.pushNotification.permission(this._getParam("safariPushID"));"default"===r.permission?i("default"):"granted"===r.permission?this._getParam("hwid")&&this._getParam("regid")?e(this):this._getParam("setupEndPoint")?(this.events.on("iframe-local-storage-params",function(){this._getParam("hwid")&&this._getParam("regid")?e(this):i("default")}.bind(this)),this.iframe.contentWindow.postMessage({method:"getLocalStorageParams"},"*")):i("default"):i("denied"===r.permission?"denied":"default")}}.bind(this),function(t){console.error("Cannot setup web push service to check user status",t),i(t)})}.bind(this))},subscribe:function(){return new Promise(function(e,i){this._setup().then(function(){"CHROME"==this._getParam("platform")||"FIREFOX"==this._getParam("platform")?(this.events.on("subscribed",function(){e(this)}.bind(this)),this.events.on("subscribed-error",function(){i()}),this.iframe.contentWindow.postMessage({method:"subscribe"},"*")):"SAFARI"==this._getParam("platform")&&t.safari.pushNotification.requestPermission(this.safariEndPoint,this._getParam("safariPushID"),{devid:this._getParam("devid"),appid:this._getParam("appid")},function(t){"default"===t.permission?i("default"):"granted"===t.permission?this._request(this.registerEndPoint,{appid:this._getParam("appid"),uuid:"null",platform:"SAFARI",regid:t.deviceToken,device:"Safari/"+navigator.userAgent.match(/Version\/(([0-9]+)(\.|[0-9])+)/i)[1],manufacturer:navigator.vendor,framework:navigator.platform?navigator.platform:navigator.oscpu},"POST").then(function(r){200==r.code&&r.hwid?(this._setParams({hwid:r.hwid,regid:t.deviceToken}),this._getParam("setupEndPoint")&&this.iframe.contentWindow.postMessage({method:"setParams",params:{hwid:r.hwid,regid:t.deviceToken}},"*"),e(this)):i(r.message)}.bind(this),function(t){console.error("Cannot register extra data for this device!",t),i(t)}):i("denied"===t.permission?"denied":"default")}.bind(this))}.bind(this),function(t){console.error("Cannot setup web push service for subscribe to webpush",t),i(t)})}.bind(this))},getLastNotifications:function(t){return new Promise(function(e,i){return this._request(this.notificationEndPoint+"/last",{devid:this._getParam("devid"),appid:this._getParam("appid"),hwid:this._getParam("hwid"),platform:this._getParam("platform"),dateFormat:t?t:""},"POST").then(function(t){for(var i=0;i<t.length;i++)t[i].payload.icon=t[i].payload.icon&&t[i].payload.icon+"".indexOf("http")!==-1?t[i].payload.icon:(this._getParam("setupEndPoint")?this._getParam("setupEndPoint"):"")+"/webpush-image.png";e(t)}.bind(this),function(t){console.error("Cannot fetch user Notifications",t),i(t)})}.bind(this))},getUnreadNotifications:function(t){return new Promise(function(e,i){return this._request(this.notificationEndPoint+"/unread",{devid:this._getParam("devid"),appid:this._getParam("appid"),hwid:this._getParam("hwid"),platform:this._getParam("platform"),dateFormat:t?t:""},"POST").then(function(t){for(var i=0;i<t.length;i++)t[i].payload.icon=t[i].payload.icon&&t[i].payload.icon+"".indexOf("http")!==-1?t[i].payload.icon:(this._getParam("setupEndPoint")?this._getParam("setupEndPoint"):"")+"/webpush-image.png";e(t)}.bind(this),function(t){console.error("Cannot fetch user Unred Notifications",t),i(t)})}.bind(this))},removeUnreadNotification:function(t){return this._request(this.notificationEndPoint+"/read-one",{devid:this._getParam("devid"),appid:this._getParam("appid"),hwid:this._getParam("hwid"),pushid:t},"DELETE")},removeAllUnreadNotifications:function(){return this._request(this.notificationEndPoint+"/read-all",{devid:this._getParam("devid"),appid:this._getParam("appid"),hwid:this._getParam("hwid")},"DELETE")},getTag:function(t){return this._request(this.tagEndPoint+"/"+this._getParam("hwid"),{devid:this._getParam("devid"),appid:this._getParam("appid"),key:t},"POST")},addTag:function(t,e,i){return i||(i="STRING"),"LIST"==i&&(e=JSON.stringify(e)),this._request(this.tagEndPoint,{devid:this._getParam("devid"),appid:this._getParam("appid"),uuid:this._getParam("hwid"),type:i,key:t,value:e},"POST")},removeTag:function(t,e,i){return i||(i="STRING"),"LIST"==i&&(e=JSON.stringify(e)),this._request(this.tagEndPoint,{devid:this._getParam("devid"),appid:this._getParam("appid"),uuid:this._getParam("hwid"),type:i,key:t,value:e},"DELETE")},optOut:function(t){return this._request(this.optOutEndPoint,{devid:this._getParam("devid"),appid:this._getParam("appid"),uuid:this._getParam("hwid"),block:t?"1":"0"},"PUT")}};t.Smartpush={create:function(t,e){if(!t.devid)return void console.error('No "devid" was NOT set. See the documentation');var r=Object.create(i);if(e){if(-1==e.indexOf("https"))return void console.error("The URL informed ("+e+") is not secure. Please, use https");"/"==e.slice(-1)&&(e=e.substring(0,e.length-1)),r.params.setupEndPoint=e}var s=r._getPlatform();if("CHROME"!=s&&"SAFARI"!=s&&"FIREFOX"!=s)return void console.info("Platform not Allowed for Webpush:",[navigator.vendor,navigator.userAgent]);if(!r._checkSupport(s))return void console.error("This browser doesnt have all features to receive webpush.");var n;switch(s){case"CHROME":if(t.appid.chrome===!1)return void console.warn("Chrome Disabled");if(!t.appid.chrome)return void console.error('No "appid" found for chrome. See the documentation');n=t.appid.chrome;break;case"SAFARI":if(t.appid.safari===!1)return void console.warn("Safari Disabled");if(!t.appid.safari)return void console.error('No "appid" found for safari. See the documentation');n=t.appid.safari;break;case"FIREFOX":if(t.appid.firefox===!1)return void console.warn("Safari Disabled");if(!t.appid.firefox)return void console.error('No "appid" found for safari. See the documentation');n=t.appid.firefox}return r._setParams({devid:t.devid,appid:n,platform:s}),r}}}(window);