!function(){"use strict";function e(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function t(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){this.map={},e instanceof r?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function i(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function s(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function n(e){var t=new FileReader;return t.readAsArrayBuffer(e),s(t)}function a(e){var t=new FileReader;return t.readAsText(e),s(t)}function o(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(l.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(l.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(e){if(!l.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText=""},l.blob?(this.blob=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(n)},this.text=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return a(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=i(this);return e?e:Promise.resolve(this._bodyText)},l.formData&&(this.formData=function(){return this.text().then(u)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(e){var t=e.toUpperCase();return p.indexOf(t)>-1?t:e}function h(e,t){t=t||{};var i=t.body;if(h.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new r(e.headers)),this.method=e.method,this.mode=e.mode,i||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",(t.headers||!this.headers)&&(this.headers=new r(t.headers)),this.method=d(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function u(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),i=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(s))}}),t}function c(e){var t=new r,i=e.getAllResponseHeaders().trim().split("\n");return i.forEach(function(e){var r=e.trim().split(":"),i=r.shift().trim(),s=r.join(":").trim();t.append(i,s)}),t}function f(e,t){t||(t={}),this._initBody(e),this.type="default",this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof r?t.headers:new r(t.headers),this.url=t.url||""}if(!self.fetch){r.prototype.append=function(r,i){r=e(r),i=t(i);var s=this.map[r];s||(s=[],this.map[r]=s),s.push(i)},r.prototype["delete"]=function(t){delete this.map[e(t)]},r.prototype.get=function(t){var r=this.map[e(t)];return r?r[0]:null},r.prototype.getAll=function(t){return this.map[e(t)]||[]},r.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},r.prototype.set=function(r,i){this.map[e(r)]=[t(i)]},r.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(r){this.map[r].forEach(function(i){e.call(t,i,r,this)},this)},this)};var l={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self},p=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];h.prototype.clone=function(){return new h(this)},o.call(h.prototype),o.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},f.error=function(){var e=new f(null,{status:0,statusText:""});return e.type="error",e};var m=[301,302,303,307,308];f.redirect=function(e,t){if(-1===m.indexOf(t))throw new RangeError("Invalid status code");return new f(null,{status:t,headers:{location:e}})},self.Headers=r,self.Request=h,self.Response=f,self.fetch=function(e,t){return new Promise(function(r,i){function s(){return"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0}var n;n=h.prototype.isPrototypeOf(e)&&!t?e:new h(e,t);var a=new XMLHttpRequest;a.onload=function(){var e=1223===a.status?204:a.status;if(100>e||e>599)return void i(new TypeError("Network request failed"));var t={status:e,statusText:a.statusText,headers:c(a),url:s()},n="response"in a?a.response:a.responseText;r(new f(n,t))},a.onerror=function(){i(new TypeError("Network request failed"))},a.open(n.method,n.url,!0),"include"===n.credentials&&(a.withCredentials=!0),"responseType"in a&&l.blob&&(a.responseType="blob"),n.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),a.send("undefined"==typeof n._bodyInit?null:n._bodyInit)})},self.fetch.polyfill=!0}}(),function(e){var t=-1===(e.location.href+"").indexOf("local.getmo.")?"https://api.getmo.com.br":"https://local.getmo.api",r={debug:!0,version:"1.2.10",iframe:document.createElement("iframe"),event:document.createElement("div"),events:{listeners:[],on:function(e,t){this.listeners.push({name:e,callback:t}),r.event.addEventListener(e,t)},off:function(e){for(var t=0;t<this.listeners.length;t++)this.listeners[t].name==e&&(r.event.removeEventListener(e,this.listeners[t].callback),this.listeners.splice(t,1))},trigger:function(e){r.event.dispatchEvent(new CustomEvent(e))},once:function(e){r.event.dispatchEvent(new CustomEvent(e)),this.off(e)}},control:{iframe:{isLoading:!1,hasLoaded:!1},hasSetup:!1,eventForPostMassageIsListening:!1,register:{tries:0,waitInSeconds:10,maxTimeoutInMinutes:1}},registerEndPoint:t+"/device",optOutEndPoint:t+"/device/optout",tagEndPoint:t+"/tag",notificationEndPoint:t+"/notifications",safariEndPoint:t+"/safari",params:{devid:null,appid:null,hwid:null,regid:null,alias:null,platform:null,setupEndPoint:null,templateEndPoint:null,safariPushID:null},_checkSupport:function(e){if(!("postMessage"in window))return void console.warn('"postMessage" is not supported.');if(!("Notification"in window))return void console.warn('"Notification" is not supported.');if(!this._checkLocalStorageSupport())return void console.error('"localStorage" is NOT supported.');if("CHROME"==e||"FIREFOX"==e){if(!("permission"in Notification))return void console.warn("This browser dont support Notification");try{if(!("showNotification"in ServiceWorkerRegistration.prototype))return void console.warn('"showNotification" is not supported.')}catch(t){return void console.warn('"showNotification" is not supported.',t)}if(!("serviceWorker"in navigator))return void console.warn('"serviceWorker" is not supported.');if(!("PushManager"in window))return void console.warn('"PushManager" is not supported.')}else if("SAFARI"==e&&!("pushNotification"in window.safari))return void console.warn('"pushNotification" is not supported.');return!0},_checkLocalStorageSupport:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},_getPlatform:function(){if("chrome"in window&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))return"CHROME";if(/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)){if("safari"in window)return"SAFARI";console.warn('Probably the user is using a mobile safari browser! "safari" object is not present on "window"')}return/Firefox/.test(navigator.userAgent)&&"undefined"!=typeof InstallTrigger?"FIREFOX":!1},_setParams:function(t){if("object"==typeof t){var r="smartpush_params";try{var i=JSON.parse(e.localStorage.getItem(r));for(var s in i)i.hasOwnProperty(s)&&(this.params[s]=i[s])}catch(n){}for(var s in t)t.hasOwnProperty(s)&&(this.params[s]=t[s]);e.localStorage.setItem(r,JSON.stringify(this.params))}},_getParam:function(e){if(this.params[e])return this.params[e];var t="smartpush_params";try{var r=JSON.parse(localStorage.getItem(t));return r[e]?(this.params[e]=r[e],r[e]):null}catch(i){return null}},_encodeParams:function(e){if("object"==typeof e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}return"string"==typeof e?e:(console.error('Parameters cannot be parsed. Use "object" or a url encoded "string". Unknown type...',typeof e),!1)},_ajax:function(e,t,r){r?(t._method=r,r="POST"):r="POST";var i=this._encodeParams(t);return e&&i?fetch(e,{method:r,headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:i}):!1},_request:function(e,t,r){return new Promise(function(i,s){this._ajax(e,t,r).then(function(e){e.json().then(function(e){i(e)},function(e){s(e)})},function(e){s(e)})}.bind(this))},_createAbsoluteUrl:function(e){var t=this._getParam("templateEndPoint"),r="";if(e.match("^https?://"))r=e;else{var i=null;"/"==e[0]?(i=/^((https?:\/\/(.+?))\/)/i.exec(t),i&&i[2]&&(r=i[2]+e)):(i=/^(https?:\/\/(.+)\/)/i.exec(t),i&&i[1]&&(r=i[1]+e))}return r},_makeBase64OfImage:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return r.drawImage(e,0,0),t.toDataURL("image/png")},_loadStylesForTemplate:function(e){var t=[],r=e.getElementsByTagName("link"),i=0,s=null;return new Promise(function(n,a){for(var o=0;o<r.length;o++)if("stylesheet"==r[o].rel){var d=r[o].href;d?(d=this._createAbsoluteUrl(d),fetch(d).then(function(e){e.text().then(function(e){var r=e.match(/url\s?\((["']?)(.+\.(png|jpg|gif|jpeg){1})\1?\)/gi);if(r)for(var i=0;i<r.length;i++){var s=/url\s?\((["']?)(.+\.(png|jpg|gif|jpeg){1})\1?\)/gi.exec(r[i]);if(s&&s[2]){var n=this._createAbsoluteUrl(s[2]);n&&(e=e.replace(r[i],"url('"+n+"')"))}}t.push(e)}.bind(this),function(){t.push("")})}.bind(this),function(e){console.error("fetch error",e),t.push("")})):t.push("")}else t.push("");s=setInterval(function(){if(t.length>=r.length){var o=document.createElement("style");for(o.innerHTML=t.join(" "),e.head.appendChild(o);r[0];)r[0].parentNode.removeChild(r[0]);clearInterval(s),n(e)}else i>50&&(clearInterval(s),a("_loadStylesForTemplate() Timeout!")),i++}.bind(this),250)}.bind(this))},_loadImagesForTemplate:function(e){var t=this,r=[],i=e.getElementsByTagName("img"),s=0,n=null;return new Promise(function(a,o){for(var d=0;d<i.length;d++){if(!i[d].src){var h=/src="((.+?)\.(jpg|jpeg|gif|png))"/gi.exec(i[d].outerHTML);if(!h||!h[1])continue;var u=this._createAbsoluteUrl(h[1]);u&&(i[d].src=u)}var c=new Image;c.addEventListener("load",function(e){r[this.id]=t._makeBase64OfImage(this),e.stopPropagation()},!0),c.addEventListener("error",function(e){cssImagesContent[this.id].base64="false",e.stopPropagation()},!0),c.id=d,c.src=i[d].src}n=setInterval(function(){if(r.length>=i.length){for(var t=0;t<i.length;t++)i[t].src=r[t];clearInterval(n),a(e)}else s>50&&(console.error("imagesContent",r),console.error("imagesTags",i),clearInterval(n),o("_loadImagesForTemplate() Timeout!")),s++}.bind(this),250)}.bind(this))},_loadImagesFromStylesForTemplate:function(e){var t=this,r={},i=e.head.outerHTML+e.body.outerHTML,s=i.match(/url\s?\((["']?)(.+\.(png|jpg|gif|jpeg){1})\1?\)/gi),n=0,a=null;return new Promise(function(o,d){if(s){for(var h=0;h<s.length;h++){var u=/url\s?\((["']?)(.+\.(png|jpg|gif|jpeg){1})\1?\)/gi.exec(s[h]);if(u&&u[2]){var c=this._createAbsoluteUrl(u[2]);c&&(r[c]={$1:u[1],$2:u[2],base64:""})}}for(var f in r)if(r.hasOwnProperty(f)){var l=new Image;l.addEventListener("load",function(e){r[this.id].base64=t._makeBase64OfImage(this),e.stopPropagation()},!0),l.addEventListener("error",function(e){r[this.id].base64="false",e.stopPropagation()},!0),l.id=f,l.src=f}a=setInterval(function(){var e=!0;for(var t in r)r.hasOwnProperty(t)&&(r[t].base64||(e=!1));if(e){for(var t in r)if(r.hasOwnProperty(t)&&"false"!=r[t].base64){var s="";s=r[t].$1?r[t].base64:"'"+r[t].base64+"'",i=i.replace(t,s).replace(r[t].$2,s)}clearInterval(a),o((new DOMParser).parseFromString("<!DOCTYPE html>"+i,"text/html"))}else n>50&&(console.error("cssImagesContent",r),clearInterval(a),d("_loadImagesFromStylesForTemplate() Timeout!")),n++}.bind(this),250)}else o(e)}.bind(this))},_cleanAndPrepareHtml:function(e){return new Promise(function(t,r){var i=(new DOMParser).parseFromString(e.replace(/<script.*?>((\n*)?.*?(\n*)?)*?<\/script>/gim,""),"text/html");this._loadStylesForTemplate(i).then(function(e){this._loadImagesForTemplate(e).then(function(e){this._loadImagesFromStylesForTemplate(e).then(function(e){var r=document.createElement("link");r.rel="manifest",r.href="/webpush-chrome-manifest.json",e.head.appendChild(r),t("<!DOCTYPE html><html>"+e.head.outerHTML+e.body.outerHTML+"</html>")}.bind(this),function(e){r(e)})}.bind(this),function(e){r(e)})}.bind(this),function(e){r(e)})}.bind(this))},_processMessageFromIframe:function(t){switch(t.data.status){case"ready":case"check-ready":case"status-false-checked":case"status-denied-checked":case"subscribed-error":case"setup-error":case"safari-has-setup":this.events.once(t.data.status);break;case"status-true-checked":this._setParams({hwid:t.data.hwid,regid:t.data.regid,alias:t.data.alias}),this.events.once(t.data.status);break;case"status-sm-unreachable":case"setup-ssl-error":if(!this._getParam("setupEndPoint")){this.events.once(t.data.status);break}case"registered-redirect":var r={subscribe:!0,callback:e.location.href};this._getParam("templateEndPoint")?fetch(this._getParam("templateEndPoint")).then(function(t){t.text().then(function(t){this._cleanAndPrepareHtml(t).then(function(t){this._setParams({templateContent:t}),this._postMessageToIframe("setParams",{templateContent:this._getParam("templateContent")}),e.location.href=this.iframe.src+"?"+this._encodeParams(r)}.bind(this),function(e){console.error(e)})}.bind(this))}.bind(this),function(e){console.error("Template target error!",e)}):e.location.href=this.iframe.src+"?"+this._encodeParams(r);break;case"subscribed":this._setParams({hwid:t.data.hwid,regid:t.data.regid,alias:t.data.alias}),this.events.once(t.data.status);break;case"unsubscribed":break;case"default":console.warn("The user close the ask box without answer to receive Notifications."),this.events.once("subscribed-default");break;case"denied":console.warn("Permission for Notifications was denied. The user denied the notification permission which means we failed to subscribe and the user will need to manually change the notification permission to subscribe to push messages."),this.events.once("subscribed-denied");break;case"error":this.events.once("subscribed-error");break;case"local-storage-center-params":this._setParams(t.data.params),this.events.once("iframe-local-storage-params");break;default:console.error("default: e.data.status = "+t.data.status)}},_postMessageToIframe:function(e,t){var r={method:e?e:""};t&&"object"==typeof t&&(r.params=t),this.iframe.contentWindow.postMessage(r,"*")},_addIframe:function(e){return this.control.iframe.hasLoaded?void e():void(this.control.iframe.isLoading||(this.iframe.id="smartpush-webpush-iframe",this.iframe.style.display="none",this.iframe.src=(this._getParam("setupEndPoint")?this._getParam("setupEndPoint"):"")+"/webpush"+(this.version?"-"+this.version:"")+".html",this.iframe.onload=function(){this.control.iframe.hasLoaded||(this.control.iframe.hasLoaded=!0,this.control.iframe.isLoading=!1,e())}.bind(this),this.iframe.onerror=function(e){console.error(e)},document.body.appendChild(this.iframe),this.control.iframe.isLoading=!0))},_addIframeEvents:function(){this.control.eventForPostMassageIsListening===!1&&(e.addEventListener?e.addEventListener("message",function(e){e.data.status&&"smartpush.webpush.iframe"==e.data.source&&this._processMessageFromIframe(e)}.bind(this),!1):e.attachEvent("onmessage",function(e){e.data.status&&"smartpush.webpush.iframe"==e.data.source&&this._processMessageFromIframe(e)}.bind(this)),this.control.eventForPostMassageIsListening=!0)},_setup:function(e){return new Promise(function(t,r){if("CHROME"==this._getParam("platform")||"FIREFOX"==this._getParam("platform")){if(this.control.hasSetup===!0)return t();this.events.on("ready",function(){this.control.hasSetup=!0,t()}.bind(this)),this.events.on("check-ready",function(){t()}.bind(this)),this.events.on("setup-error",function(){r("error")}),this.events.on("setup-ssl-error",function(){console.error("DOMException: Only secure origins are allowed (see: https://goo.gl/Y0ZkNV)."),r("ssl-error")}),this._addIframeEvents(),this._addIframe(function(){this._postMessageToIframe(e,{devid:this._getParam("devid"),appid:this._getParam("appid"),platform:this._getParam("platform"),setupEndPoint:this._getParam("setupEndPoint")})}.bind(this))}else if("SAFARI"==this._getParam("platform")){if(this._getParam("safariPushID")&&this._getParam("hwid")&&this._getParam("regid"))return t(),!0;var i=this.safariEndPoint+"/getPushID";this._request(i,{devid:this._getParam("devid"),appid:this._getParam("appid")},"POST").then(function(e){(e.code=e.safariPushID)?(this._setParams({safariPushID:e.safariPushID}),t()):r(e.message)}.bind(this),function(e){console.error("Cannot fetch safari app Push ID",e),r(e)})}}.bind(this))},_getBrowserVersion:function(){switch(this._getParam("platform")){case"CHROME":return navigator.userAgent.match(/Chrom(e|ium|eframe)\/([0-9]+)\./i)[0];case"FIREFOX":return navigator.userAgent.match(/Firefox\/([0-9]+)\./i)[0];case"SAFARI":return"Safari/"+navigator.userAgent.match(/Version\/(([0-9]+)(\.|[0-9])+)/i)[1]}return""},getAlias:function(){return this._getParam("alias")},checkStatus:function(){return new Promise(function(t,r){this._setup().then(function(){if("CHROME"==this._getParam("platform")||"FIREFOX"==this._getParam("platform"))this.events.on("status-true-checked",function(){t(this)}.bind(this)),this.events.on("status-false-checked",function(){r("default")}),this.events.on("status-denied-checked",function(){r("denied")}),this.events.on("status-sm-unreachable",function(){this._getParam("setupEndPoint")||(document.body.removeChild(document.getElementById("smartpush-webpush-iframe")),this.control.hasSetup=!1,this.control.iframe.hasLoaded=!1),r("default")}.bind(this)),this._postMessageToIframe("checkSubscriptionStatus");else if("SAFARI"==this._getParam("platform")){var i=e.safari.pushNotification.permission(this._getParam("safariPushID"));"default"===i.permission?r("default"):"granted"===i.permission?this._getParam("hwid")&&this._getParam("regid")?t(this):this._getParam("setupEndPoint")?(this.events.on("iframe-local-storage-params",function(){this._getParam("hwid")&&this._getParam("regid")?t(this):r("default")}.bind(this)),this._postMessageToIframe("getLocalStorageParams")):r("default"):r("denied"===i.permission?"denied":"default")}}.bind(this),function(e){console.error("Cannot setup web push service to check user status",e),r(e)})}.bind(this))},subscribe:function(){return new Promise(function(t,r){this._setup("initializeServiceWorker").then(function(){"CHROME"==this._getParam("platform")||"FIREFOX"==this._getParam("platform")?(this.events.on("subscribed",function(){t(this)}.bind(this)),this.events.on("subscribed-error",function(){r("error")}),this.events.on("subscribed-default",function(){r("default")}),this.events.on("subscribed-denied",function(){r("denied")}),this._postMessageToIframe("subscribe")):"SAFARI"==this._getParam("platform")&&e.safari.pushNotification.requestPermission(this.safariEndPoint,this._getParam("safariPushID"),{devid:this._getParam("devid"),appid:this._getParam("appid")},function(e){"default"===e.permission?r("default"):"granted"===e.permission?this._request(this.registerEndPoint,{appid:this._getParam("appid"),uuid:"null",platform:"SAFARI",regid:e.deviceToken,device:"Safari/"+navigator.userAgent.match(/Version\/(([0-9]+)(\.|[0-9])+)/i)[1],manufacturer:navigator.vendor,framework:navigator.platform?navigator.platform:navigator.oscpu},"POST").then(function(i){200==i.code&&i.hwid?(this._setParams({hwid:i.hwid,regid:e.deviceToken,alias:i.alias}),this._getParam("setupEndPoint")&&this._postMessageToIframe("setParams",{devid:this._getParam("devid"),appid:this._getParam("appid"),hwid:i.hwid,regid:e.deviceToken,alias:i.alias,platform:this._getParam("platform"),setupEndPoint:this._getParam("setupEndPoint")}),t(this)):(console.error(i.message),r("error"))}.bind(this),function(e){console.error("Cannot register extra data for this device!",e),r("error")}):r("denied"===e.permission?"denied":"default")}.bind(this))}.bind(this),function(e){console.error("Cannot setup web push service for subscribe to webpush",e),r("error")})}.bind(this))},getLastNotifications:function(e){return new Promise(function(t,r){return this._request(this.notificationEndPoint+"/last",{devid:this._getParam("devid"),appid:this._getParam("appid"),hwid:this._getParam("hwid"),platform:this._getParam("platform"),dateFormat:e?e:"",browserVersion:this._getBrowserVersion()},"POST").then(function(e){for(var r=0;r<e.length;r++)e[r].payload.icon=e[r].payload.icon&&e[r].payload.icon+"".indexOf("http")!==-1?e[r].payload.icon:(this._getParam("setupEndPoint")?this._getParam("setupEndPoint"):"")+"/webpush-image.png";t(e)}.bind(this),function(e){console.error("Cannot fetch user Notifications",e),r(e)})}.bind(this))},getUnreadNotifications:function(e){return new Promise(function(t,r){return this._request(this.notificationEndPoint+"/unread",{devid:this._getParam("devid"),appid:this._getParam("appid"),hwid:this._getParam("hwid"),platform:this._getParam("platform"),dateFormat:e?e:"",browserVersion:this._getBrowserVersion()},"POST").then(function(e){for(var r=0;r<e.length;r++)e[r].payload.icon=e[r].payload.icon&&e[r].payload.icon+"".indexOf("http")!==-1?e[r].payload.icon:(this._getParam("setupEndPoint")?this._getParam("setupEndPoint"):"")+"/webpush-image.png";t(e)}.bind(this),function(e){console.error("Cannot fetch user Unred Notifications",e),r(e)})}.bind(this))},removeUnreadNotification:function(e){return this._request(this.notificationEndPoint+"/read-one",{devid:this._getParam("devid"),appid:this._getParam("appid"),hwid:this._getParam("hwid"),pushid:e,browserVersion:this._getBrowserVersion()},"DELETE")},removeAllUnreadNotifications:function(){return this._request(this.notificationEndPoint+"/read-all",{devid:this._getParam("devid"),appid:this._getParam("appid"),hwid:this._getParam("hwid"),browserVersion:this._getBrowserVersion()},"DELETE")},getTag:function(e){return this._request(this.tagEndPoint+"/"+this._getParam("hwid"),{devid:this._getParam("devid"),appid:this._getParam("appid"),key:e,browserVersion:this._getBrowserVersion()},"POST")},addTag:function(e,t,r){return r||(r="STRING"),"LIST"==r&&(t=JSON.stringify(t)),this._request(this.tagEndPoint,{devid:this._getParam("devid"),appid:this._getParam("appid"),uuid:this._getParam("hwid"),type:r,key:e,value:t,browserVersion:this._getBrowserVersion()},"POST")},removeTag:function(e,t,r){return r||(r="STRING"),"LIST"==r&&(t=JSON.stringify(t)),this._request(this.tagEndPoint,{devid:this._getParam("devid"),appid:this._getParam("appid"),uuid:this._getParam("hwid"),type:r,key:e,value:t,browserVersion:this._getBrowserVersion()},"DELETE")},optOut:function(e){return this._request(this.optOutEndPoint,{devid:this._getParam("devid"),appid:this._getParam("appid"),uuid:this._getParam("hwid"),block:e?"1":"0",browserVersion:this._getBrowserVersion()},"PUT")}};e.Smartpush={create:function(e){if(!e.devid||"DEVID"==e.devid)return void console.error('No "devid" was NOT set. See the documentation');var t=Object.create(r),i=e.sslUrl;if(i){if(-1==i.indexOf("https"))return void console.error("The URL informed ("+i+") is not secure. Please, use https");"/"==i.slice(-1)&&(i=i.substring(0,i.length-1)),t._setParams({setupEndPoint:i})}else t._setParams({setupEndPoint:!1});var s=e.templateUrl;s?("/"==s.slice(-1)&&(s=s.substring(0,s.length-1)),t._setParams({templateEndPoint:s})):t._setParams({templateEndPoint:!1});var n=t._getPlatform();if("CHROME"!=n&&"SAFARI"!=n&&"FIREFOX"!=n)return void console.info("Platform not Allowed for Webpush:",[navigator.vendor,navigator.userAgent]);if(!t._checkSupport(n))return void console.error("This browser doesnt have all features to receive webpush.");var a;switch(n){case"CHROME":if(e.appid.chrome===!1)return void console.warn("Chrome Disabled");if(!e.appid.chrome||"APPID"==e.appid.chrome)return void console.error('No "appid" found for chrome. See the documentation');a=e.appid.chrome;break;case"SAFARI":if(e.appid.safari===!1)return void console.warn("Safari Disabled");if(!e.appid.safari||"APPID"==e.appid.chrome)return void console.error('No "appid" found for safari. See the documentation');a=e.appid.safari;break;case"FIREFOX":if(e.appid.firefox===!1)return void console.warn("Safari Disabled");if(!e.appid.firefox||"APPID"==e.appid.chrome)return void console.error('No "appid" found for firefox. See the documentation');a=e.appid.firefox}return t._setParams({devid:e.devid,appid:a,platform:n}),t}}}(window);