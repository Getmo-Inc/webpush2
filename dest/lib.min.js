!function(){"use strict";function e(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function t(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){this.map={},e instanceof r?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function n(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function i(e){var t=new FileReader;return t.readAsArrayBuffer(e),n(t)}function s(e){var t=new FileReader;return t.readAsText(e),n(t)}function a(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(f.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(f.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(e){if(!f.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText=""},f.blob?(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(i)},this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return s(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=o(this);return e?e:Promise.resolve(this._bodyText)},f.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function p(e){var t=e.toUpperCase();return h.indexOf(t)>-1?t:e}function u(e,t){t=t||{};var o=t.body;if(u.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new r(e.headers)),this.method=e.method,this.mode=e.mode,o||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",(t.headers||!this.headers)&&(this.headers=new r(t.headers)),this.method=p(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function d(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(n))}}),t}function c(e){var t=new r,o=e.getAllResponseHeaders().trim().split("\n");return o.forEach(function(e){var r=e.trim().split(":"),o=r.shift().trim(),n=r.join(":").trim();t.append(o,n)}),t}function l(e,t){t||(t={}),this._initBody(e),this.type="default",this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof r?t.headers:new r(t.headers),this.url=t.url||""}if(!self.fetch){r.prototype.append=function(r,o){r=e(r),o=t(o);var n=this.map[r];n||(n=[],this.map[r]=n),n.push(o)},r.prototype["delete"]=function(t){delete this.map[e(t)]},r.prototype.get=function(t){var r=this.map[e(t)];return r?r[0]:null},r.prototype.getAll=function(t){return this.map[e(t)]||[]},r.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},r.prototype.set=function(r,o){this.map[e(r)]=[t(o)]},r.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(r){this.map[r].forEach(function(o){e.call(t,o,r,this)},this)},this)};var f={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self},h=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];u.prototype.clone=function(){return new u(this)},a.call(u.prototype),a.call(l.prototype),l.prototype.clone=function(){return new l(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},l.error=function(){var e=new l(null,{status:0,statusText:""});return e.type="error",e};var m=[301,302,303,307,308];l.redirect=function(e,t){if(-1===m.indexOf(t))throw new RangeError("Invalid status code");return new l(null,{status:t,headers:{location:e}})},self.Headers=r,self.Request=u,self.Response=l,self.fetch=function(e,t){return new Promise(function(r,o){function n(){return"responseURL"in s?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):void 0}var i;i=u.prototype.isPrototypeOf(e)&&!t?e:new u(e,t);var s=new XMLHttpRequest;s.onload=function(){var e=1223===s.status?204:s.status;if(100>e||e>599)return void o(new TypeError("Network request failed"));var t={status:e,statusText:s.statusText,headers:c(s),url:n()},i="response"in s?s.response:s.responseText;r(new l(i,t))},s.onerror=function(){o(new TypeError("Network request failed"))},s.open(i.method,i.url,!0),"include"===i.credentials&&(s.withCredentials=!0),"responseType"in s&&f.blob&&(s.responseType="blob"),i.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send("undefined"==typeof i._bodyInit?null:i._bodyInit)})},self.fetch.polyfill=!0}}(),function(e){"use strict";var t,r,o,n,i,s="2.0.1",a=-1===(e.location.href+"").indexOf("local.getmo.")?"https://api.getmo.com.br":"https://local.getmo.api";t=function(){},t.prototype.element=e.document.createElement("div"),t.prototype.listeners=[],t.prototype._getIndex=function(e){var t;for(t=0;t<this.listeners.length;t++)if(this.listeners[t].name===e)return t;return!1},t.prototype.on=function(e,t){this.listeners.push({name:e,callback:t,type:"on"}),this.element.addEventListener(e,t)},t.prototype.one=function(e,t){this.listeners.push({name:e,callback:t,type:"one"}),this.element.addEventListener(e,t)},t.prototype.off=function(e){var t=this._getIndex(e);t!==!1&&(this.element.removeEventListener(e,this.listeners[t].callback),this.listeners.splice(t,1))},t.prototype.trigger=function(t,r){this.element.dispatchEvent(new e.CustomEvent(t,{detail:r}));var o=this._getIndex(t);o!==!1&&"one"===this.listeners[o].type&&this.off(t)},t.prototype.once=function(t,r){this.element.dispatchEvent(new e.CustomEvent(t,{detail:r})),this.off(t)},r=function(){this._platform=null,this._browserVersion=null},r.prototype._checkFeature=function(t){switch(t){case"postMessage":return"postMessage"in e;case"Notification":return"Notification"in e;case"localStorage":try{return"localStorage"in e&&null!==e.localStorage}catch(r){return!1}break;case"permission":return"permission"in e.Notification;case"showNotification":try{return"showNotification"in e.ServiceWorkerRegistration.prototype}catch(r){return}break;case"serviceWorker":return"serviceWorker"in e.navigator;case"PushManager":return"PushManager"in e;case"pushNotification":return"pushNotification"in e.safari}return!0},r.prototype._getPlatform=function(){if(this._platform)return this._platform;var e=this._getPlatformName();return this._platform=e||null,this._platform},r.prototype._getPlatformName=function(){if(e.hasOwnProperty("chrome")&&/Chrome/.test(e.navigator.userAgent)&&/Google Inc/.test(e.navigator.vendor))return"CHROME";if(/Firefox/.test(e.navigator.userAgent)&&"undefined"!==e.InstallTrigger)return"FIREFOX";if(/Safari/.test(e.navigator.userAgent)&&/Apple Computer/.test(e.navigator.vendor)){if(e.hasOwnProperty("safari"))return"SAFARI";console.warn('Probably the user is using a mobile safari browser! "safari" object is not present on "window"')}return!1},r.prototype._getBrowserVersion=function(){if(this._browserVersion)return this._browserVersion;var t="";switch(this._getPlatform()){case"CHROME":t=e.navigator.userAgent.match(/Chrom(e|ium|eframe)\/([0-9]+)\./i)[0];break;case"FIREFOX":t=e.navigator.userAgent.match(/Firefox\/([0-9]+)\./i)[0];break;case"SAFARI":t="Safari/"+e.navigator.userAgent.match(/Version\/(([0-9]+)(\.|[0-9])+)/i)[1]}return this._browserVersion=t||null,this._browserVersion},r.prototype._checkAllFeatures=function(){if(!this._checkFeature("postMessage"))return void console.warn('"postMessage" is not supported.');if(!this._checkFeature("Notification"))return void console.warn('"Notification" is not supported.');if(!this._checkFeature("localStorage"))return void console.warn('"localStorage" is not supported.');var e=this._getPlatform();if("CHROME"===e||"FIREFOX"===e){if(!this._checkFeature("permission"))return void console.warn("This browser dont support Notifications");if(!this._checkFeature("showNotification"))return void console.warn('"showNotification" is not supported.');if(!this._checkFeature("serviceWorker"))return void console.warn('"serviceWorker" is not supported.');if(!this._checkFeature("PushManager"))return void console.warn('"PushManager" is not supported.')}else if("SAFARI"===e&&!this._checkFeature("pushNotification"))return void console.warn('"pushNotification" is not supported.');return!0},o=function(t){this.baseUrl=t||e.location.href},o.prototype._createAbsoluteUrl=function(e){var t="",r=null;if(e)return e.match("^https?://")?t=e:"/"===e[0]?(r=/^((https?:\/\/(.+?))\/)/i.exec(this.baseUrl),r&&r[2]&&(t=r[2]+e)):(r=/^(https?:\/\/(.+)\/)/i.exec(this.baseUrl),r&&r[1]&&(t=r[1]+e)),t},o.prototype._makeBase64OfImage=function(t){var r=e.document.createElement("canvas"),o=r.getContext("2d");return r.width=t.width,r.height=t.height,o.drawImage(t,0,0),r.toDataURL("image/png")},o.prototype._loadImageBase64FromUrl=function(t){var r,o,n,i=this;return new Promise(function(s,a){r=new e.Image,r.addEventListener("load",function(e){clearInterval(o),s(i._makeBase64OfImage(this)),e.stopPropagation()},!0),r.addEventListener("error",function(e){clearInterval(o),a(e),e.stopPropagation()},!0),r.src=i._createAbsoluteUrl(t),o=setInterval(function(){n>150&&(clearInterval(o),a("_loadImageBase64FromUrl() Timeout!")),n+=1},50)})},o.prototype._loadStylesForTemplate=function(t){var r,o,n,i,s,a,p=this,u=[],d=t.getElementsByTagName("link"),c=0,l=null;return new Promise(function(f,h){for(r=0;r<d.length;r++)"stylesheet"===d[r].rel?(n=d[r].href,n?(n=p._createAbsoluteUrl(n),e.fetch(n).then(function(e){e.text().then(function(e){if(i=e.match(/url\s?\((["']?)(.+\.(png|jpg|gif|jpeg){1})\1?\)/gi))for(o=0;o<i.length;o++)s=/url\s?\((["']?)(.+\.(png|jpg|gif|jpeg){1})\1?\)/gi.exec(i[o]),s&&s[2]&&(a=p._createAbsoluteUrl(s[2]),a&&(e=e.replace(i[o],"url('"+a+"')")));u.push(e)},function(){u.push("")})},function(e){console.error("fetch error",e),u.push("")})):u.push("")):u.push("");l=setInterval(function(){if(u.length>=d.length){var r=e.document.createElement("style");for(r.innerHTML=u.join(" "),t.head.appendChild(r);d[0];)d[0].parentNode.removeChild(d[0]);clearInterval(l),f(t)}else c>150&&(console.error("cssTags",d),console.error("cssContent",u),clearInterval(l),h("_loadStylesForTemplate() Timeout!")),c+=1},50)})},o.prototype._loadImagesForTemplate=function(t){var r,o,n,i,s,a=this,p=[],u=t.getElementsByTagName("img"),d=0,c=null;return new Promise(function(l,f){for(i=0;i<u.length;i++){if(!u[i].src){if(r=/src="((.+?)\.(jpg|jpeg|gif|png))"/gi.exec(u[i].outerHTML),!r||!r[1])continue;o=a._createAbsoluteUrl(r[1]),o&&(u[i].src=o)}n=new e.Image,n.addEventListener("load",function(e){p[this.id]=a._makeBase64OfImage(this),e.stopPropagation()},!0),n.addEventListener("error",function(e){p[this.id].base64="false",e.stopPropagation()},!0),n.id=i,n.src=u[i].src}c=setInterval(function(){if(p.length>=u.length){for(s=0;s<u.length;s++)u[s].src=p[s];clearInterval(c),l(t)}else d>150&&(console.error("imagesContent",p),console.error("imagesTags",u),clearInterval(c),f("_loadImagesForTemplate() Timeout!")),d+=1},50)})},o.prototype._loadImagesFromStylesForTemplate=function(t){var r,o,n,i,s,a,p,u,d=this,c={},l=t.head.outerHTML+t.body.outerHTML,f=l.match(/url\s?\((["']?)(.+\.(png|jpg|gif|jpeg){1})\1?\)/gi),h=0,m=null,g=!0;return new Promise(function(v,_){if(f){for(r=0;r<f.length;r++)s=/url\s?\((["']?)(.+\.(png|jpg|gif|jpeg){1})\1?\)/gi.exec(f[r]),s&&s[2]&&(a=d._createAbsoluteUrl(s[2]),a&&(c[a]={$1:s[1],$2:s[2],base64:""}));for(o in c)c.hasOwnProperty(o)&&(p=new e.Image,p.addEventListener("load",function(e){c[this.id].base64=d._makeBase64OfImage(this),e.stopPropagation()},!0),p.addEventListener("error",function(e){c[this.id].base64="false",e.stopPropagation()},!0),p.id=o,p.src=o);m=setInterval(function(){for(n in c)c.hasOwnProperty(n)&&(c[n].base64||(g=!1));if(g){for(i in c)c.hasOwnProperty(i)&&"false"!==c[i].base64&&(u="",u=c[i].$1?c[i].base64:"'"+c[i].base64+"'",l=l.replace(i,u).replace(c[i].$2,u));clearInterval(m),v((new e.DOMParser).parseFromString("<!DOCTYPE html>"+l,"text/html"))}else h>150&&(console.error("cssImagesContent",c),clearInterval(m),_("_loadImagesFromStylesForTemplate() Timeout!")),h+=1},50)}else v(t)})},o.prototype._cleanAndPrepareHtml=function(t){var r=this;return new Promise(function(o,n){var i=(new e.DOMParser).parseFromString(t.replace(/<script.*?>((\n*)?.*?(\n*)?)*?<\/script>/gim,""),"text/html");r._loadStylesForTemplate(i).then(function(t){r._loadImagesForTemplate(t).then(function(t){r._loadImagesFromStylesForTemplate(t).then(function(t){var r=e.document.createElement("link");r.rel="manifest",r.href="/webpush-chrome-manifest.json",t.head.appendChild(r),o("<!DOCTYPE html><html>"+t.head.outerHTML+t.body.outerHTML+"</html>")},function(e){n(e)})},function(e){n(e)})},function(e){n(e)})})},n=function(){this.data={devid:null,appid:null,hwid:null,regid:null,alias:null,platform:null,setupEndPoint:null,templateEndPoint:null,safariPushID:null}},n.prototype._get=function(t,r){if(this.data[t])return this.data[t];r=r||"smartpush_params";try{var o=JSON.parse(e.localStorage.getItem(r));return o[t]||o[t]===!1?(this.data[t]=o[t],o[t]):null}catch(n){return null}},n.prototype._set=function(t,r){var o,n,i;if("object"==typeof t){r=r||"smartpush_params";try{i=JSON.parse(e.localStorage.getItem(r));for(o in i)i.hasOwnProperty(o)&&(this.data[o]=i[o])}catch(s){}for(n in t)t.hasOwnProperty(n)&&(this.data[n]=t[n]);e.localStorage.setItem(r,JSON.stringify(this.data))}},i=function(){this.version=s,this.iframe=e.document.createElement("iframe"),this.popup=null},i.prototype.events=new t,i.prototype.support=new r,i.prototype.template=new o,i.prototype.params=new n,i.prototype.control={iframe:{isLoading:!1,hasLoaded:!1},hasSetup:!1,eventForPostMassageIsListening:!1,register:{tries:0,waitInSeconds:10,maxTimeoutInMinutes:1}},i.prototype.registerEndPoint=a+"/device",i.prototype.optOutEndPoint=a+"/device/optout",i.prototype.tagEndPoint=a+"/tag",i.prototype.notificationEndPoint=a+"/notifications",i.prototype.safariEndPoint=a+"/safari",i.prototype._encodeParams=function(e){var t,r=[];if("object"==typeof e){for(t in e)e.hasOwnProperty(t)&&r.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return r.join("&")}return"string"==typeof e?e:(console.error('Parameters cannot be parsed. Use "object" or a url encoded "string". Unknown type...',typeof e),!1)},i.prototype._request=function(t,r,o){var n=this._encodeParams(r);return new Promise(function(r,i){return t&&n?(o?(n+="&_method="+o,o="POST"):o="POST",void e.fetch(t,{method:o,headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:n}).then(function(e){e.json().then(function(e){r(e)},function(e){i(e)})},function(e){i(e)})):(i("URL: "+t+" | PARAMS: "+n),!1)})},i.prototype._processMessageFromIframe=function(e){e.data.eventId||"subscribed"!==e.data.status||"object"!=typeof e.data.params?e.data.eventId&&this.events.once(e.data.eventId,e.data):(this.params._set(e.data.params),this.events.once("subscribed"))},i.prototype._postMessageToIframe=function(e,t){var r=this;return new Promise(function(o,n){if(!r.iframe)return n("Iframe dont exist or wasnt initialize yet.");e=e||"";var i=null,s={eventId:e+"-"+(new Date).getTime()+"-"+Math.random(),action:e};t&&"object"==typeof t&&(s.params=t),r.events.one(s.eventId,function(e){clearTimeout(i),e.detail&&e.detail.params&&"object"==typeof e.detail.params&&r.params._set(e.detail.params),o(e.detail)}),"doSubscribe"!==e&&(i=setTimeout(function(){n("postMessage event timeout: "+s.eventId)},5e3)),r.iframe.contentWindow.postMessage(s,"*")})},i.prototype._addIframe=function(t){var r=this;return this.control.iframe.hasLoaded?void t():void(this.control.iframe.isLoading||(this.iframe.id="smartpush-webpush-iframe",this.iframe.style.display="none",this.iframe.src=(this.params._get("setupEndPoint")||"")+"/lib"+(this.version?"-"+this.version:"")+".html",this.iframe.onload=function(){r.control.iframe.hasLoaded||(r.control.iframe.hasLoaded=!0,r.control.iframe.isLoading=!1,t())},this.iframe.onerror=function(e){console.error(e)},e.document.body.appendChild(this.iframe),this.control.iframe.isLoading=!0))},i.prototype._addIframeEvents=function(){var t=this;this.control.eventForPostMassageIsListening===!1&&(e.addEventListener?e.addEventListener("message",function(e){"smartpush.webpush.iframe"===e.data.source&&t._processMessageFromIframe(e)},!1):e.attachEvent("onmessage",function(e){"smartpush.webpush.iframe"===e.data.source&&t._processMessageFromIframe(e)}),this.control.eventForPostMassageIsListening=!0)},i.prototype._openPopUp=function(){var t=440,r=330,o=e.screen.width/2-t/2,n=e.screen.height/2-r/2,i="toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width="+t+",height="+r+",left="+o+",top="+n,s=this.params._get("setupEndPoint")+"/lib"+(this.version?"-"+this.version:"")+".html";return!this.popup||this.popup.closed?this.popup=e.open(s,"notification",i):this.popup&&!this.popup.closed?this.popup.focus():this.popup=e.open(s,"notification",i),this.popup?(this.popup.focus(),!0):!1},i.prototype._setupUserTemplate=function(){var t,r=this,n={callback:e.location.href,subscribe:!0};e.fetch(r.params._get("templateEndPoint")).then(function(i){i.text().then(function(i){t=new o(r.params._get("templateEndPoint")),t._cleanAndPrepareHtml(i).then(function(t){t.length>5232400?console.error("Your template is too big!"):r._postMessageToIframe("ping",{template:t}).then(function(){e.location.href=r.iframe.src+"?"+r._encodeParams(n)},function(e){console.error("postMessage timeout!",e)})},function(e){console.error(e)})})},function(e){console.error("Template target error!",e)})},i.prototype._setupDefaultTemplate=function(t){var r,n,i=this,s={callback:e.location.href};r=i.params._get("templateImageUrl"),r&&-1===r.indexOf("https")?(n=new o,n._loadImageBase64FromUrl(r).then(function(r){i._postMessageToIframe("ping",{templateImageBase64:r}).then(function(){t?e.location.href=i.iframe.src+"?"+i._encodeParams(s):i._openPopUp()},function(e){console.error(e)})},function(e){console.error(e)})):t?e.location.href=i.iframe.src+"?"+i._encodeParams(s):i._openPopUp()},i.prototype._setup=function(t){var r=this,o=this.support._getPlatform(),n=!1;return new Promise(function(i,s){if("CHROME"===o||"FIREFOX"===o){if("initSubscribe"===t&&(r.params._get("hwid")&&r.params._get("regid")||r.params._get("setupEndPoint")&&!r.params._get("templateEndPoint")&&(r._openPopUp()||(n=!0))),r.control.hasSetup===!0)return i();r._addIframeEvents(),r._addIframe(function(){r._postMessageToIframe(t,{devid:r.params._get("devid"),appid:r.params._get("appid"),platform:r.params._get("platform"),setupEndPoint:r.params._get("setupEndPoint"),templateEndPoint:r.params._get("templateEndPoint"),templateImageUrl:r.params._get("templateImageUrl"),templateSiteName:r.params._get("templateSiteName")}).then(function(t){switch(console.log("that.control.hasSetup",r.control.hasSetup),console.log("data",t),t.status){case"ready":r.control.hasSetup=!0,i(t);break;case"pong":i(t);break;case"setup-ssl-error":case"setup-error":if(!r.params._get("setupEndPoint")){s(t);break}case"setup-reload":if(-1!==e.location.href.indexOf("https"))return void console.warn("You are using a secure connection. HTTPS");case"registered-redirect":r.control.hasSetup=!0,r.checkStatus().then(function(e){if(r.params._get("templateEndPoint")){if("denied"===e)return void i(t);r._setupUserTemplate()}else r._setupDefaultTemplate(n)},function(e){console.error(e)})}},function(e){console.error("postMessage timeout!",e),s()})})}else if("SAFARI"===o){if(r.params._get("safariPushID")&&r.params._get("hwid")&&r.params._get("regid"))return i(),!0;r._request(r.safariEndPoint+"/getPushID",{devid:r.params._get("devid"),appid:r.params._get("appid")},"POST").then(function(e){200===e.code&&e.safariPushID?(r.params._set({safariPushID:e.safariPushID}),i()):s(e.message)},function(e){console.error("Cannot fetch safari app Push ID",e),s(e)})}})},i.prototype.checkStatus=function(){var t=this,r=this.support._getPlatform();return new Promise(function(o,n){t._setup("checkStatus").then(function(){if("CHROME"===r||"FIREFOX"===r)t._postMessageToIframe("checkSubscriptionStatus").then(function(r){switch(r.status){case"status-true-checked":o("granted");break;case"status-sm-unreachable":t.params._get("setupEndPoint")||(e.document.body.removeChild(e.document.getElementById("smartpush-webpush-iframe")),t.control.hasSetup=!1,t.control.iframe.hasLoaded=!1);case"status-false-checked":o("default");break;case"status-denied-checked":o("denied")}},function(e){n(e)});else if("SAFARI"===r){var i=e.safari.pushNotification.permission(t.params._get("safariPushID"));"default"===i.permission?o("default"):"granted"===i.permission?t.params._get("hwid")&&t.params._get("regid")?o("granted"):t.params._get("setupEndPoint")?t._postMessageToIframe("getLocalStorageParams").then(function(){o("granted")},function(){console.error("postMessage timeout!"),o("default")}):o("default"):o("denied"===i.permission?"denied":"default")}},function(e){console.error("Cannot setup web push service to check user status",e),n(e)})})},i.prototype.subscribe=function(){var t=this,r=this.support._getPlatform();return new Promise(function(o,n){t._setup("initSubscribe").then(function(){"CHROME"===r||"FIREFOX"===r?t.checkStatus().then(function(e){return"denied"==e?void n("denied"):t.params._get("hwid")&&t.params._get("regid")&&"granted"==e?void o(t):t.params._get("setupEndPoint")&&!t.params._get("templateEndPoint")&&t._openPopUp()?void t.events.one("subscribed",function(){o(t)}):void t._postMessageToIframe("doSubscribe").then(function(e){switch(e.status){case"subscribed":o(t);break;case"subscribed-error":n("error");break;case"default":n("default");break;case"denied":n("denied");break;default:console.error('No "data.status" match',e.status),n("error")}},function(e){console.error(e),n("error")})},function(e){console.error(e),n("error")}):"SAFARI"===r&&e.safari.pushNotification.requestPermission(t.safariEndPoint,t.params._get("safariPushID"),{devid:t.params._get("devid"),appid:t.params._get("appid")},function(i){"default"===i.permission?n("default"):"granted"===i.permission?t._request(t.registerEndPoint,{appid:t.params._get("appid"),uuid:"null",platform:r,regid:i.deviceToken,device:"Safari/"+e.navigator.userAgent.match(/Version\/(([0-9]+)(\.|[0-9])+)/i)[1],manufacturer:e.navigator.vendor,framework:e.navigator.platform||e.navigator.oscpu},"POST").then(function(e){200===e.code&&e.hwid?(t.params._set({hwid:e.hwid,regid:i.deviceToken,alias:e.alias}),t.params._get("setupEndPoint")&&t._postMessageToIframe("ping",{devid:t.params._get("devid"),appid:t.params._get("appid"),hwid:e.hwid,regid:i.deviceToken,alias:e.alias,platform:t.params._get("platform"),setupEndPoint:t.params._get("setupEndPoint"),templateEndPoint:t.params._get("templateEndPoint"),templateImageUrl:t.params._get("templateImageUrl"),templateSiteName:t.params._get("templateSiteName")}).then(function(e){"pong"===e.status?o(t):n("Its not you! Baby...")},function(){console.error("Cannot set parameters on centralized domain."),n("error")})):(console.error(e.message),n("error"))},function(e){console.error("Cannot register extra data for this device!",e),n("error")}):n("denied"===i.permission?"denied":"default")})},function(e){console.error("Cannot setup web push service for subscribe to webpush",e),n("error")})})},i.prototype.unSubscribe=function(){var e=this;return new Promise(function(t,r){e._postMessageToIframe("unsubscribe").then(function(o){switch(o.status){case"unsubscribed":e._request(e.registerEndPoint,{devid:e.params._get("devid"),appid:e.params._get("appid"),uuid:e.params._get("hwid")},"DELETE").then(function(){e.params._set({regid:null,alias:null}),e.params._get("templateEndPoint")&&(e.control.hasSetup=!1),t()},function(e){console.error("Cannot un-register this user on DB. It will be removed in next dry-run!",e),r()});break;case"unsubscribed-error":r()}},function(){r()})})},i.prototype.getLastNotifications=function(e){var t,r=this;return new Promise(function(o,n){return r._request(r.notificationEndPoint+"/last",{devid:r.params._get("devid"),appid:r.params._get("appid"),hwid:r.params._get("hwid"),platform:r.support._getPlatform(),dateFormat:e||"",browserVersion:r.support._getBrowserVersion()},"POST").then(function(e){for(t=0;t<e.length;t++)e[t].payload.icon=e[t].payload.icon&&e[t].payload.icon+"".indexOf("http")!==-1?e[t].payload.icon:(r.params._get("setupEndPoint")?r.params._get("setupEndPoint"):"")+"/webpush-image.png";o(e)},function(e){console.error("Cannot fetch user Notifications",e),n(e)})})},i.prototype.getUnreadNotifications=function(e){var t,r=this;return new Promise(function(o,n){return r._request(r.notificationEndPoint+"/unread",{devid:r.params._get("devid"),appid:r.params._get("appid"),hwid:r.params._get("hwid"),platform:r.support._getPlatform(),dateFormat:e||"",browserVersion:r.support._getBrowserVersion()},"POST").then(function(e){for(t=0;t<e.length;t++)e[t].payload.icon=e[t].payload.icon&&e[t].payload.icon+"".indexOf("http")!==-1?e[t].payload.icon:(r.params._get("setupEndPoint")?r.params._get("setupEndPoint"):"")+"/webpush-image.png";o(e)},function(e){console.error("Cannot fetch user Unred Notifications",e),n(e)})})},i.prototype.removeUnreadNotification=function(e){return this._request(this.notificationEndPoint+"/read-one",{devid:this.params._get("devid"),appid:this.params._get("appid"),hwid:this.params._get("hwid"),pushid:e,browserVersion:this.support._getBrowserVersion()},"DELETE")},i.prototype.removeAllUnreadNotifications=function(){return this._request(this.notificationEndPoint+"/read-all",{devid:this.params._get("devid"),appid:this.params._get("appid"),hwid:this.params._get("hwid"),browserVersion:this.support._getBrowserVersion()},"DELETE")},i.prototype.getTag=function(e){return this._request(this.tagEndPoint+"/"+this.params._get("hwid"),{devid:this.params._get("devid"),appid:this.params._get("appid"),key:e,browserVersion:this.support._getBrowserVersion()},"POST")},i.prototype.addTag=function(e,t,r){return r||(r="STRING"),"LIST"===r&&(t=JSON.stringify(t)),this._request(this.tagEndPoint,{devid:this.params._get("devid"),appid:this.params._get("appid"),uuid:this.params._get("hwid"),type:r,key:e,value:t,browserVersion:this.support._getBrowserVersion()},"POST")},i.prototype.removeTag=function(e,t,r){return r||(r="STRING"),"LIST"===r&&(t=JSON.stringify(t)),this._request(this.tagEndPoint,{devid:this.params._get("devid"),appid:this.params._get("appid"),uuid:this.params._get("hwid"),type:r,key:e,value:t,browserVersion:this.support._getBrowserVersion()},"DELETE")},i.prototype.optOut=function(e){return this._request(this.optOutEndPoint,{devid:this.params._get("devid"),appid:this.params._get("appid"),uuid:this.params._get("hwid"),block:e?"1":"0",browserVersion:this.support._getBrowserVersion()},"PUT")},i.prototype.getAlias=function(){return this.params._get("alias")},e.Smartpush={create:function(t){if(!t.devid||"DEVID"===t.devid)return void console.error('"devid" was NOT set, see the documentation');if("object"!=typeof t.appid)return void console.error('"appid" must be an Object');if(t.ssl&&"object"!=typeof t.ssl)return void console.error('"ssl" must be an Object');if(t.template&&"object"!=typeof t.template)return void console.error('"template" must be an Object');var r=new i,o=r.support._getPlatform();if("CHROME"!==o&&"SAFARI"!==o&&"FIREFOX"!==o)return void console.info("Platform not Allowed for Webpush:",[e.navigator.vendor,e.navigator.userAgent]);if(!r.support._checkAllFeatures())return void console.error("This browser doesnt have all features to receive webpush.");var n=t.ssl;if(n&&n.url&&"string"==typeof n.url){if(-1===n.url.indexOf("https"))return void console.error("The URL informed ("+n.url+") is not secure. Please, use https");"/"===n.url.slice(-1)&&(n.url=n.url.substring(0,n.url.length-1))}else n=!1;if(r.params._set({setupEndPoint:n&&n.url?n.url:!1}),-1===window.location.href.indexOf("https")&&!r.params._get("setupEndPoint"))return void console.error('You are using a "http" connection, but the URL in the "ssl" object, in the setup() method, dont exist or is invalid. See the documentation');var s=n.template||!1;if(s)if("string"==typeof s){if(-1===s.indexOf("http"))return void console.error('To use the template render feature, you must inform a valid absolute url for the "template" property');if("SAFARI"!==o&&!r.params._get("setupEndPoint"))return void console.error('Without a valid ssl "url" you cant make use of the template render feature');"/"===s.slice(-1)&&(s=s.substring(0,s.length-1)),r.params._set({templateEndPoint:s,templateImageUrl:!1,templateSiteName:!1})}else if("object"==typeof s){if(s.imageUrl&&-1===s.imageUrl.indexOf("http"))return void console.error('To use a custom image, you must inform a valid absolute url for the "imageUrl" property');r.params._set({templateEndPoint:!1,templateImageUrl:s.imageUrl||!1,templateSiteName:s.siteName||!1})}else r.params._set({templateEndPoint:!1,templateImageUrl:!1,templateSiteName:!1});else r.params._set({templateEndPoint:!1,templateImageUrl:!1,templateSiteName:!1});var a;switch(o){case"CHROME":if(t.appid.chrome===!1)return void console.warn("Chrome Disabled");if(!t.appid.chrome||"APPID"===t.appid.chrome)return void console.error('No "appid" found for chrome. See the documentation');a=t.appid.chrome;break;case"SAFARI":if(t.appid.safari===!1)return void console.warn("Safari Disabled");if(!t.appid.safari||"APPID"===t.appid.chrome)return void console.error('No "appid" found for safari. See the documentation');a=t.appid.safari;break;case"FIREFOX":if(t.appid.firefox===!1)return void console.warn("Safari Disabled");if(!t.appid.firefox||"APPID"===t.appid.chrome)return void console.error('No "appid" found for firefox. See the documentation');a=t.appid.firefox}return r.params._set({devid:t.devid,appid:a,platform:o}),r}}}(window);